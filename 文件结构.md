# 项目文件结构

## 目录结构

```
vsc_PublishAutoUpdateVersion/
├── src/                          # 源代码目录
│   ├── types/                    # 类型定义
│   │   ├── config.ts            # 配置文件类型定义
│   │   └── version.ts           # 版本号相关类型定义
│   ├── utils/                    # 工具类
│   │   ├── configReader.ts      # 配置文件读取工具
│   │   └── versionUtils.ts      # 版本号处理工具
│   ├── services/                 # 业务服务
│   │   ├── fileVersionService.ts # 文件版本服务
│   │   └── userInteractionService.ts # 用户交互服务
│   └── extension.ts             # 扩展主入口
├── out/                          # 编译输出目录（自动生成）
├── node_modules/                 # 依赖包（自动生成）
├── package.json                  # 扩展配置文件
├── tsconfig.json                 # TypeScript 配置
├── .versionconfig.example        # 配置文件示例
├── .vscodeignore                 # VSCode 打包忽略文件
├── .gitignore                    # Git 忽略文件
├── README.md                     # 项目说明文档
└── README.en.md                  # 英文说明文档
```

## 文件说明

### 源代码文件

#### types/config.ts
- **功能**: 定义配置文件的数据结构
- **主要类型**:
  - `FileVersionConfig`: 单个文件的版本配置
  - `AutoUpdateConfig`: 完整的配置文件结构

#### types/version.ts
- **功能**: 定义版本号相关的类型
- **主要类型**:
  - `VersionUpdateType`: 版本更新类型枚举（Patch、Minor、Major、Custom）
  - `FileVersionInfo`: 文件版本信息

#### utils/configReader.ts
- **功能**: 读取和解析 `.versionconfig` 配置文件
- **主要方法**:
  - `findProjectRoot()`: 查找项目根目录
  - `readConfig()`: 读取配置文件
  - `findProjectRoots()`: 查找工作区中所有项目的根目录

#### utils/versionUtils.ts
- **功能**: 版本号处理工具
- **主要方法**:
  - `incrementVersion()`: 递增版本号
  - `validateVersion()`: 验证版本号格式
  - `extractVersion()`: 从文本中提取版本号

#### services/fileVersionService.ts
- **功能**: 文件版本号操作服务
- **主要方法**:
  - `readFile()`: 读取文件内容
  - `writeFile()`: 写入文件内容
  - `getCurrentVersion()`: 获取文件当前版本号
  - `updateVersion()`: 更新文件中的版本号
  - `updatePackageJsonVersion()`: 特殊处理 package.json
  - `getFileVersionInfos()`: 批量获取文件版本信息

#### services/userInteractionService.ts
- **功能**: 用户交互服务（VSCode UI）
- **主要方法**:
  - `selectFilesToUpdate()`: 选择要更新的文件
  - `selectUpdateType()`: 选择版本更新方式
  - `confirmUpdate()`: 确认更新操作
  - `showSuccessMessage()`: 显示成功消息
  - `showErrorMessage()`: 显示错误消息

#### extension.ts
- **功能**: 扩展主入口文件
- **主要功能**:
  - 注册 VSCode 命令
  - 处理版本更新流程
  - 协调各个服务模块

### 配置文件

#### package.json
- VSCode 扩展的配置文件
- 定义了扩展的基本信息、命令、依赖等

#### tsconfig.json
- TypeScript 编译配置
- 指定编译选项和输出目录

#### .versionconfig.example
- 配置文件示例模板
- 用户可参考此文件创建自己的配置文件

## 模块关系

```
extension.ts (主入口)
    ├── ConfigReader (读取配置)
    │   └── AutoUpdateConfig
    ├── FileVersionService (文件操作)
    │   ├── VersionUtils (版本处理)
    │   └── FileVersionInfo
    └── UserInteractionService (用户交互)
        └── VersionUpdateType
```

## 数据流

1. **配置读取**: `ConfigReader` 读取 `.versionconfig` 配置文件
2. **版本提取**: `FileVersionService` 使用 `VersionUtils` 从文件中提取版本号
3. **用户交互**: `UserInteractionService` 显示 UI 让用户选择文件和更新方式
4. **版本更新**: `FileVersionService` 根据用户选择更新文件中的版本号
5. **结果反馈**: `UserInteractionService` 显示更新结果

## 设计原则

1. **单一职责**: 每个类/模块只负责一个功能
2. **依赖注入**: 通过参数传递依赖，便于测试
3. **错误处理**: 所有可能出错的地方都有适当的错误处理
4. **类型安全**: 使用 TypeScript 严格类型检查
5. **可扩展性**: 通过配置文件支持任意文件类型和正则表达式

