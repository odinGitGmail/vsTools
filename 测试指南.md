# 插件测试指南

## 在扩展开发宿主中测试插件

### 1. 启动扩展开发宿主

#### 方法一：使用调试功能（推荐）
1. 在 VSCode 中打开本项目
2. 按 `F5` 键，或点击左侧"运行和调试"面板（`Ctrl+Shift+D`）
3. 选择"运行扩展"配置
4. 点击绿色播放按钮，或直接按 `F5`

#### 方法二：使用命令面板
1. 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）打开命令面板
2. 输入 "Debug: Start Debugging"
3. 选择 "运行扩展"

**注意**: 首次运行会自动编译项目，之后会打开一个新的 VSCode 窗口（扩展开发宿主窗口）

### 2. 准备测试项目

在扩展开发宿主窗口中，需要创建一个测试项目来验证插件功能：

#### 步骤 1: 创建测试工作区
1. 在扩展开发宿主窗口中，点击 "文件" → "打开文件夹"
2. 选择一个空文件夹或创建一个新的测试文件夹（例如：`/tmp/vscode-extension-test`）

#### 步骤 2: 创建测试文件

**创建 package.json:**
```json
{
  "name": "test-project",
  "version": "0.0.1",
  "description": "测试项目"
}
```

**创建 README.md:**
```markdown
# 测试项目

![Version](https://img.shields.io/badge/version-0.0.1-blue.svg)

这是一个测试项目。
```

**创建 .csproj 文件（可选）:**
```xml
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <Version>0.0.1</Version>
  </PropertyGroup>
</Project>
```

#### 步骤 3: 创建配置文件

在测试项目根目录创建 `.versionconfig`:

```json
{
  "files": [
    {
      "path": "package.json",
      "versionRegex": "\"version\"\\s*:\\s*\"([\\d.]+)\"",
      "description": "Node.js 项目版本号"
    },
    {
      "path": "README.md",
      "versionRegex": "!\\[Version\\]\\(https://img\\.shields\\.io/badge/version-([\\d.]+)-blue\\.svg\\)",
      "description": "README 版本徽章"
    }
  ]
}
```

### 3. 测试插件功能

#### 测试步骤

1. **打开命令面板**
   - 在扩展开发宿主窗口中按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）

2. **执行更新版本号命令**
   - 输入 "更新版本号" 或 "updateVersion"
   - 选择该命令

3. **选择项目**（如果有多个项目）
   - 如果工作区中有多个包含 `.versionconfig` 的项目，会提示选择项目
   - 选择要测试的项目

4. **选择要更新的文件**
   - 会显示所有配置的文件及其当前版本号
   - 可以选择一个或多个文件（默认全选）
   - 点击 "确定" 或按 `Enter`

5. **选择版本更新方式**
   - **Patch（补丁版本）**: 0.0.1 → 0.0.2
   - **Minor（次版本）**: 0.0.1 → 0.1.0
   - **Major（主版本）**: 0.0.1 → 1.0.0
   - **自定义版本号**: 手动输入，例如 2.5.3

6. **确认更新**
   - 会显示更新预览（哪些文件将从哪个版本更新到哪个版本）
   - 点击 "确认" 执行更新
   - 点击 "取消" 放弃更新

7. **验证结果**
   - 检查文件中的版本号是否已更新
   - 查看是否显示成功消息

### 4. 测试场景

#### 场景 1: 单个文件更新
- 配置文件中只有一个文件
- 验证是否能正确提取和更新版本号

#### 场景 2: 多个文件更新
- 配置文件中包含多个文件
- 验证是否能同时更新多个文件的版本号
- 验证版本号是否保持一致

#### 场景 3: 不同版本号格式
- 测试不同格式的版本号（如 1.0.0, 0.1.0, 0.0.1）
- 验证版本号递增逻辑是否正确

#### 场景 4: 自定义版本号
- 测试手动输入版本号
- 验证版本号格式验证是否有效

#### 场景 5: 多项目工作区
- 在工作区中创建多个项目，每个项目都有自己的 `.versionconfig`
- 验证是否能正确识别和选择项目

#### 场景 6: 错误处理
- 测试文件不存在的情况
- 测试版本号格式不正确的情况
- 测试正则表达式无法匹配的情况
- 验证错误提示是否友好

### 5. 调试技巧

#### 查看控制台输出
1. 在原始 VSCode 窗口（开发窗口）中
2. 打开 "调试控制台"（`Ctrl+Shift+Y`）
3. 查看扩展的日志输出

#### 设置断点
1. 在源代码中设置断点（点击行号左侧）
2. 在扩展开发宿主中执行命令
3. 程序会在断点处暂停，可以查看变量值、调用栈等

#### 查看扩展开发宿主控制台
1. 在扩展开发宿主窗口中
2. 按 `Ctrl+Shift+P`，输入 "Developer: Toggle Developer Tools"
3. 打开开发者工具，查看控制台输出和错误信息

### 6. 常见问题

#### 问题 1: 找不到配置文件
**原因**: `.versionconfig` 不在项目根目录，或路径不正确
**解决**: 确保配置文件在项目根目录，文件名正确

#### 问题 2: 版本号未更新
**原因**: 正则表达式不匹配，或文件路径不正确
**解决**: 
- 检查正则表达式是否正确
- 检查文件路径是否相对于项目根目录
- 查看错误消息了解详细信息

#### 问题 3: 扩展未激活
**原因**: 扩展可能未正确加载
**解决**: 
- 检查 `package.json` 中的 `activationEvents` 配置
- 重新启动扩展开发宿主
- 查看原始窗口的调试控制台是否有错误

#### 问题 4: 命令找不到
**原因**: 扩展未正确注册命令
**解决**: 
- 检查 `package.json` 中的 `contributes.commands` 配置
- 确保已重新编译（`npm run compile`）
- 重新启动扩展开发宿主

### 7. 快速测试脚本

可以创建一个简单的测试脚本来快速创建测试环境：

```bash
#!/bin/bash
# 创建测试项目
mkdir -p /tmp/vscode-extension-test
cd /tmp/vscode-extension-test

# 创建 package.json
cat > package.json << EOF
{
  "name": "test-project",
  "version": "0.0.1",
  "description": "测试项目"
}
EOF

# 创建 README.md
cat > README.md << EOF
# 测试项目

![Version](https://img.shields.io/badge/version-0.0.1-blue.svg)

这是一个测试项目。
EOF

# 创建 .versionconfig
cat > .versionconfig << EOF
{
  "files": [
    {
      "path": "package.json",
      "versionRegex": "\\"version\\"\\\\s*:\\\\s*\\"([\\\\d.]+)\\"",
      "description": "Node.js 项目版本号"
    },
    {
      "path": "README.md",
      "versionRegex": "!\\\\[Version\\\\]\\\\(https://img\\\\.shields\\\\.io/badge/version-([\\\\d.]+)-blue\\\\.svg\\\\)",
      "description": "README 版本徽章"
    }
  ]
}
EOF

echo "测试项目已创建在 /tmp/vscode-extension-test"
echo "请在扩展开发宿主中打开该文件夹进行测试"
```

### 8. 测试检查清单

- [ ] 单个文件更新正常
- [ ] 多个文件同时更新正常
- [ ] Patch 版本递增正确（0.0.1 → 0.0.2）
- [ ] Minor 版本递增正确（0.0.1 → 0.1.0）
- [ ] Major 版本递增正确（0.0.1 → 1.0.0）
- [ ] 自定义版本号输入和验证正常
- [ ] 文件选择界面正常
- [ ] 错误提示友好且准确
- [ ] 多项目工作区支持正常
- [ ] package.json 特殊处理正常
- [ ] 正则表达式匹配和替换正常

