# 状态栏不显示版本号问题排查

如果状态栏没有显示版本号，请按以下步骤排查：

## 排查步骤

### 1. 检查项目根目录是否有 `.versionconfig` 文件

状态栏功能需要项目根目录下有 `.versionconfig` 配置文件。

**检查方法：**
- 在项目根目录查看是否有 `.versionconfig` 文件
- 如果没有，请参考 `.versionconfig.example` 创建配置文件

### 2. 检查配置文件格式是否正确

**正确的配置文件格式：**
```json
{
  "files": [
    {
      "path": "package.json",
      "versionRegex": "\"version\"\\s*:\\s*\"([\\d.]+)\"",
      "description": "Node.js 项目版本号"
    }
  ]
}
```

**常见错误：**
- JSON 格式错误（缺少逗号、引号等）
- `files` 数组为空
- `path` 或 `versionRegex` 字段缺失

### 3. 检查版本号来源

状态栏会按以下优先级查找版本号：

**优先级 1：package.json**
- 检查项目根目录是否有 `package.json` 文件
- 检查 `package.json` 中是否有 `version` 字段
- 检查 `version` 字段的值是否为有效的版本号格式（如 `1.2.3`）

**优先级 2：配置文件中的其他文件**
- 如果 `package.json` 没有版本号，会尝试从配置文件中指定的其他文件读取
- 检查配置文件中指定的文件是否存在
- 检查正则表达式是否能正确匹配版本号

### 4. 检查文件路径

- 确保配置文件中的 `path` 是相对于项目根目录的路径
- 例如：如果 `package.json` 在根目录，路径应该是 `"package.json"`，而不是 `"./package.json"` 或 `"/package.json"`

### 5. 检查正则表达式

确保正则表达式能正确匹配版本号。

**package.json 示例：**
```json
{
  "version": "1.2.3"
}
```
对应的正则表达式应该是：`"version"\\s*:\\s*"([\\d.]+)"`

**测试正则表达式：**
- 可以使用在线正则表达式测试工具验证
- 确保正则表达式中有捕获组 `([\\d.]+)` 来捕获版本号

### 6. 检查编辑器状态

- 确保编辑器中有文件被激活（不是空白编辑器）
- 确保打开的文件在项目目录中（不是未保存的文件）

## 快速测试方法

1. **创建测试配置：**
   在项目根目录创建 `.versionconfig`：
   ```json
   {
     "files": [
       {
         "path": "package.json",
         "versionRegex": "\"version\"\\s*:\\s*\"([\\d.]+)\"",
         "description": "版本号"
       }
     ]
   }
   ```

2. **确保 package.json 有版本号：**
   ```json
   {
     "name": "my-project",
     "version": "1.0.0"
   }
   ```

3. **重新加载窗口：**
   - 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
   - 输入 "Developer: Reload Window"
   - 重新加载后，打开项目中的任意文件，状态栏应该显示版本号

## 常见问题

### Q: 为什么状态栏显示后又消失了？
A: 可能的原因：
- 切换到了未保存的文件
- 切换到了项目外的文件
- 版本号文件被删除或修改

### Q: 状态栏显示 "vundefined"？
A: 说明找到了项目，但无法提取版本号。检查：
- `package.json` 中的 `version` 字段是否存在
- 正则表达式是否正确

### Q: 多个项目时状态栏显示哪个版本？
A: 状态栏显示当前激活文件所在项目的版本号。

## 调试方法

如果以上方法都无法解决问题，可以：

1. **查看开发者工具：**
   - 按 `Ctrl+Shift+P`（Mac: `Cmd+Shift+P`）
   - 输入 "Developer: Toggle Developer Tools"
   - 查看控制台是否有错误信息

2. **检查扩展日志：**
   - 在原始 VSCode 窗口（开发窗口）的调试控制台查看日志

3. **重新安装扩展：**
   - 如果问题持续，尝试重新安装扩展

